---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# CausalStress

> **⚠️ Early Access (v0.1.1)**\
> CausalStress is currently in **Alpha**.\
> The **architecture is stable and fully tested**, but the **DGP and Estimator libraries are minimal** in this release.\
> We encourage experimentation, but **do not use for production research** until v0.2.0.

**CausalStress** is a **scientific instrument** for benchmarking causal inference estimators.\
It enforces strict *Constitutional Guarantees* to ensure:

-   reproducibility\
-   comparability\
-   fairness\
-   version safety\
-   crash resilience

even as estimators and DGPs grow increasingly complex.

------------------------------------------------------------------------

# Why This Exists

Causal inference simulations today are often fragile:

-   **Truth Drift:** The “true effect” depends on the seed or sample instead of the structural model.\
-   **Data Leakage:** Estimators accidentally see `y0`, `y1`, or true `p`.\
-   **Silent Failure:** One crash = three days lost.\
-   **Version Drift:** Results from last month can’t be reproduced because code changed silently.

These are **not** coding problems... They are **governance problems**.

CausalStress solves them by introducing a **Constitution**: a simple set of rules that enforce scientific hygiene.

Not a manifesto.\
Not philosophy.\
Just **guardrails** for reliable science.

------------------------------------------------------------------------

# The Constitutional Guarantees

### **1. Two-Tier Truth (Article I)**

True effects are computed using a massive Oracle sample ($N=10^6$), independent of the simulation sample.

### **2. The Airlock (Article III)**

Forbidden columns are physically removed before any estimator sees the data:

```         
y0, y1, p, structural_te
```

Leakage becomes impossible by construction.

### **3. Atomic Persistence (Article VI)**

Each seed is immediately saved to a `pins` board.\
If your cluster dies on seed 999/1000 you're safe.

### **4. Provenance & Time Travel (Article II)**

Every result includes:

-   Git hash\
-   Timestamp\
-   Full R Session Info

So you can always reproduce or load old runs.

------------------------------------------------------------------------

# Installation

``` r
# install.packages("pak")
pak::pak("blechturm/CausalStress")
```

------------------------------------------------------------------------

# The Workflow

**Run → Persist → Audit → Tidy**

We benchmark two estimators (`lm_att`, `ipw_att`) on two DGPs:

-   `synth_baseline`\
-   `synth_heavytail`

More are coming soon, including **theory-backed stress DGPs** and **famous datasets** (IHDP, Lalonde, Kang–Schafer, ACIC-style generators).

------------------------------------------------------------------------

## 1. Run a Campaign

```{r}
library(CausalStress)
library(dplyr)
library(pins)

board <- pins::board_temp()

runs <- cs_run_grid(
  dgp_ids       = c("synth_baseline", "synth_heavytail"),
  estimator_ids = c("lm_att", "ipw_att"),
  n             = 500,
  seeds         = 1:5,
  bootstrap     = TRUE,
  B             = 100,
  board         = board,
  skip_existing = TRUE
)
```



------------------------------------------------------------------------

## 2. Tidy the Results

```{r}
runs_tidy <- runs %>%
  cs_tidy()

runs_tidy %>%
  select(dgp_id, estimator_id, seed, est_att, att_ci_width, att_covered) %>%
  head(6)
```


------------------------------------------------------------------------

## 3. Scorecard Summary

```{r}
summary <- cs_summarise_runs(runs_tidy)

summary %>% 
  select(dgp_id, estimator_id, RMSE = mean_error, Coverage = mean_att_covered)
```



------------------------------------------------------------------------

## 4. Audit and Time Travel

```{r}
history <- cs_audit(board)

history %>%
  select(dgp_id, estimator_id, seed, git_hash, timestamp) %>%
  head(5)
```


You can retrieve any run from any git commit, ever.

------------------------------------------------------------------------

# Extensibility: Registries & Plugins

CausalStress maintains two central registries:

### DGP Registry

```{r}
CausalStress:::cs_dgp_registry()
```


### Estimator Registry

```{r}
CausalStress:::cs_estimator_registry()
```


DGPs and Estimators can be added via:

-   `cs_register_dgp()`\
-   `cs_register_estimator()`

The Airlock guarantees that custom estimators receive **only legal inputs**.

### Upcoming DGP Library (v0.2–v0.3)

We will add **theory-backed stress tests**:

-   heteroskedastic confounding\
-   heavy-tail outcomes\
-   missingness mechanisms\
-   weak instruments\
-   near-violations of ignorability\
-   overlap collapse scenarios

And later:

-   Lalonde\
-   IHDP\
-   Kang & Schafer\
-   ACIC generators\
-   DoubleML benchmark datasets

------------------------------------------------------------------------

# Python Support (v0.4.0)

Many SOTA estimators are Python-only (EconML, DoWhy, DragonNet).\
We support them with a **Hub & Spoke** model:

### R = Hub

-   Generates data\
-   Enforces truth & airlock\
-   Stores provenance\
-   Persists results atomically

### Python = Spoke

-   Receives Parquet\
-   Trains estimator\
-   Returns predictions in a strict schema

This ensures **fairness, reproducibility, and no leakage** across languages.

------------------------------------------------------------------------

# Parallelization (Constitutional Requirement)

Parallel execution is explicitly part of the Constitution (Article V: *Computational Safety*).

**Why not in the MVP?**\
Parallelism touches:

-   RNG determinism\
-   Progress bars\
-   Atomic writes\
-   Resume logic\
-   Future cluster safety

Now that all foundations are stable, parallelization is coming in **v0.2.0**.

Planned API:

```{r, eval = FALSE}
library(future)
plan(multisession)

with_progress({
  cs_run_grid(..., parallel = TRUE)
})
```


Thanks to atomic seeds, this is **race-free, deterministic, and resume-safe**.

------------------------------------------------------------------------

# Vignettes

See:

```{r, eval = FALSE}

vignette("from-run-to-history", package = "CausalStress")
```



------------------------------------------------------------------------

# Citation

If you use CausalStress, please cite:

> Thomasberger, M. (2025). *CausalStress: A Constitutional Framework for Causal Benchmarking.* R package version 0.1.0.

\`\`\`